(function(n){n.widget("ui.popupBalloon",{options:{popupClass:"",width:400,height:130,positionX:null,positionY:null,title:"",content:"",jScrollPaneEnabled:!0,insetMargin:0,animationDistance:50,positioningMode:"normal",alignTo:n("body"),popupPosition:"right",popupAlign:"center",xAlign:"right",xOffset:0,xOffsetInverted:"auto",yAlign:"center",yOffset:0,yOffsetInverted:"auto",arrowEnabled:!0,animateDisplayEnabled:!0,animateMoveEnabled:!0,animateHideEnabled:!0,animationSpeed:300,interactionMode:"none",mouseNearPadding:10},_create:function(){var t=this,f=t.element,i=t.options,r,u;t.iDevices=n.iDevices?n.iDevices:{iPad:navigator.userAgent.indexOf("iPad")!=-1};t.preferences={popupPosition:i.popupPosition,popupAlign:i.popupAlign};i.xOffsetInverted=="auto"&&(i.xOffsetInverted=0,n(t.element).is("shape")||(r=n(t.element).width(),i.popupPosition=="right"&&i.xAlign=="right"&&(i.xOffsetInverted=r*-1),i.popupPosition=="left"&&i.xAlign=="left"&&(i.xOffsetInverted=r)));i.yOffsetInverted=="auto"&&(i.yOffsetInverted=0,n(t.element).is("shape")||(u=n(t.element).height(),i.popupPosition=="top"&&i.yAlign=="top"&&(i.yOffsetInverted=u/2),i.popupPosition=="bottom"&&i.yAlign=="bottom"&&(i.yOffsetInverted=u/-2)));n(document).unbind("mousemove.popup-balloon").bind("mousemove.popup-balloon",function(n){if(t.mouseX=n.pageX,t.mouseY=n.pageY,t.nearCallout=!1,t.isVisible()){var r=i.mouseNearPadding;t.mouseX>=t.currentX-r&&t.mouseX<=t.currentX+t.currentWidth+r&&t.mouseY>=t.currentY-r&&t.mouseY<=t.currentY+t.currentHeight+r&&(t.nearCallout=!0)}t.nearCallout&&t._trigger("popupMouseNear",n,t.popbox)});window.setTimeout(function(){n("body").unbind("mousedown.popup-balloon").bind("mousedown.popup-balloon",function(i){n(i.target).data("popbox")||t._removeOldPopups();i.stopPropagation()})},20)},_init:function(){var t=this,i=t.element,r=t.options;t.visible=!1;r.animateDisplayEnabled||(r.animationDistance=0);r.popupPosition=t.preferences.popupPosition;popupAlign=t.preferences.popupAlign;switch(r.interactionMode){case"custom":case"none":n(".popup-balloon").length?n(i).data("timestamp")==n(".popup-balloon").data("timestamp")?t.hide():t.show():t.show();break;case"click":n(i).bind("click",function(){t.visible||(t._hide(!0),t.show())});break;case"hover":n(i).bind("mouseenter",function(){clearTimeout(n.data(this,"bubbleTimeout"));var i=n(this).data("ibubbleIsOpened");i||(n(this).data("ibubbleIsOpened",!0),t.show())});n(i).bind("mouseleave",function(){n(this).data("bubbleTimeout",window.setTimeout(function(){var t=n(i).data("ibubbleIsOpened");t&&(n(i).removeData("ibubbleIsOpened"),n(i).popupBalloon("hide"),clearTimeout(n(i).data("bubbleTimeout")))},300))})}},_setOption:function(n,t){var i=this,u=i.element,r=i.options;if(i.popbox)switch(n){case"popupClass":i.popbox.removeClass().addClass("popup-balloon").addClass(t);r.title&&i.popbox.addClass("with-title");r.arrowEnabled&&i.popbox.addClass("with-arrow");r[n]=t;break;case"title":i.popbox.find(".title").text(t);r[n]=t;break;case"content":i.popbox.find(".content").empty().html(t);i._setCalloutHeight("auto");r.jScrollPaneEnabled&&i.popbox.find(".content").jScrollPane({showArrows:!0,autoReinitialise:!1,verticalDragMaxHeight:52,verticalGutter:10,horizontalGutter:20});r[n]=t;break;case"width":i.popbox.find(".popup-body, .header .title").outerWidth(t);i.currentWidth=t;r[n]=t;break;case"height":i._setCalloutHeight(t);r[n]=t;break;case"popupPosition":case"popupAlign":i.preferences[n]=r[n]=t;break;default:r[n]=t}},show:function(){var i=this,u=i.element,r=i.options,f,t;if(!i.visible){f=(new Date).getTime();u.data("popbox")&&i._hide();r.interactionMode=="hover"&&i._hide(!0);t=n('<div class="popup-balloon"><div class="balloon-arrow"><\/div><div class="popup-body"><div class="content"><\/div><\/div><\/div>');i.popbox=t;t.data("controller",u);t.data("timestamp",f);u.data("timestamp",f);r.popupClass&&t.addClass(r.popupClass);r.title&&(t.addClass("with-title"),t.prepend('<div class="header"><div class="title ellipsis">'+r.title+"<\/div><\/div>"));r.content&&t.find(".content").empty().html(r.content);r.arrowEnabled&&t.addClass("with-arrow");i._removeOldPopups();n("body").append(t);t.find(".popup-body, .header .title").outerWidth(r.width);i.currentWidth=r.width;i._setCalloutHeight(r.height);r.popupPosition=i.preferences.popupPosition;r.popupAlign=i.preferences.popupAlign;t.attr({position:r.popupPosition,popupalign:r.popupAlign});var e=i._getCoordinates(t),o=e.x,s=e.y;t.bind("mousemove",function(n){n.stopPropagation();i._trigger("popupMouseMove",n,t)}).bind("mousedown",function(n){n.stopPropagation();i._trigger("popupMouseDown",n,t)}).bind("mouseenter",function(n){i._trigger("popupMouseEnter",n,t)}).bind("mouseleave",function(n){i._trigger("popupMouseLeave",n,t)});r.interactionMode=="hover"&&(t.bind("mouseenter",function(){clearTimeout(n(u).data("bubbleTimeout"))}),t.bind("mouseleave",function(){n(u).data("bubbleTimeout",window.setTimeout(function(){var t=n(u).data("ibubbleIsOpened");t&&(n(u).removeData("ibubbleIsOpened"),n(u).popupBalloon("hide"),clearTimeout(n(u).data("bubbleTimeout")))},300))}));r.jScrollPaneEnabled&&t.find(".content").jScrollPane({showArrows:!0,autoReinitialise:!0,verticalDragMaxHeight:52,verticalGutter:10,horizontalGutter:20});typeof $dj=="undefined"&&(window.$dj={maxZIndex:99999});t.css("z-index",++$dj.maxZIndex);u.data("popbox",t);this.visible=!0;i.positionElement(t,o,s,function(){i._trigger("onShow")})}},_hide:function(t){var r=this,f=r.element,u=r.options,i=f.data("popbox");t&&(i=n(".popup-balloon"));i&&i.length&&(u.animateHideEnabled&&!t?i.fadeOut(u.animationSpeed,function(){n(this).remove()}):i.each(function(){n(this).data("controller").popupBalloon("hide")}))},hide:function(){var n=this;n._hide();n.visible=!1;n._trigger("onHide")},_setCalloutHeight:function(n){var t=this,u=t.element,f=t.options,i,r;n=="auto"?t.popbox.find(".content").outerHeight(t.popbox.find(".content").height("").outerHeight()):(i=t.popbox.find(".header .title").outerHeight(),r=n-i,t.popbox.find(".content").outerHeight(r));t.currentHeight=t.popbox.height()},positionElement:function(t,i,r,u){var e=this,h=e.element,f=e.options,o=f.popupPosition=="right"?f.animationDistance:f.popupPosition=="left"?f.animationDistance*-1:0,s=f.popupPosition=="bottom"?f.animationDistance:f.popupPosition=="top"?f.animationDistance*-1:0;f.animateDisplayEnabled?(n(t).css({top:r+s+"px",left:i+o+"px",display:"block"}),n(t).stop().animate({left:"-="+o,top:"-="+s},f.animationSpeed,function(){n(this).css({opacity:"",zoom:"",filter:""});e.scrollDocument(u)})):(n(t).stop().css({top:r+"px",left:i+"px",display:"block",opacity:"",zoom:"",filter:""}),e.scrollDocument(u));e.currentX=i;e.currentY=r},updatePosition:function(t,i){var r=this,h=r.element,u=r.options,f=h.data("popbox");u.positionX=t;u.positionY=i;u.popupPosition=r.preferences.popupPosition;u.popupAlign=r.preferences.popupAlign;var s=r._getCoordinates(f),e=s.x,o=s.y;f.attr({position:u.popupPosition,popupalign:u.popupAlign});u.animateMoveEnabled?f.stop().animate({top:o,left:e},u.animationSpeed,function(){n(this).css({opacity:"",zoom:"",filter:""});r.scrollDocument()}):(f.css({top:o,left:e,opacity:"",zoom:"",filter:""}),r.scrollDocument());r.currentX=e;r.currentY=o},rePosition:function(t){var r=this,e=r.options,i=this.popbox,u=n("div.content",i),o=n(".balloon-arrow",i),c=i.offset(),v=o.position(),l=u.height(),f=0,s=0,a,h;o.offset().left+o.width()<n(r.element).offset().left?(a=r._getCoordinates(i),h=n(r.element).outerWidth(!0),n(r.element).is("shape")&&(h=parseInt(h/3)),n(i).animate({left:a.x-h+"px"},200,t)):n.isFunction(t)&&t();u.children().size()>0&&(u.children().each(function(){f=f+n(this).outerHeight()}),f>l?(s=f-l,e.popupAlign!="top"&&e.popupAlign!="bottom"&&e.popupAlign!="under-title"?(i.animate({top:c.top-s/2+"px"},{duration:200,queue:!1}),o.animate({top:v.top+s/2+"px"},{duration:200,queue:!1})):e.popupAlign=="bottom"&&i.animate({top:c.top-s+"px"},{duration:200,queue:!1}),u.animate({height:f},{duration:200,queue:!1,complete:function(){n(this).css({height:"",overflow:"visible"});r.scrollDocument(t)}})):n.isFunction(t)&&t(),u.children(":visible").show())},scrollDocument:function(t){var u=this.popbox;if(u.is(":visible")){var s=this,i=u.offset(),e=u.outerHeight(),o=n(window).height(),f=s.iDevices.iPad?window.pageYOffset:n(document).scrollTop(),r=0;o+f-i.top<e?r=e-(o-i.top)+1:f>0&&f-i.top>0&&(r=i.top-1);r?n("body").stop().animate({scrollTop:r},500,t||n.noop()):n.isFunction(t)&&t()}},getpopbox:function(){return this.popbox},isVisible:function(){return this.visible},_getCoordinates:function(t){var p=this,w=p.element,i=p.options,h=n(t).outerHeight(),o=n(t).outerWidth(),l=n(t).find(".balloon-arrow"),v=i.arrowEnabled?l.outerWidth():0,a=i.arrowEnabled?l.outerHeight():0,c=n(w),r,u,e,y,f,s;if(i.positioningMode=="alignTo"&&(c=i.alignTo),i.positionX||i.positionX===0||i.positionY||i.positionY===0)r=i.positionX,u=i.positionY;else if(i.positioningMode=="cursor")r=p.mouseX,u=p.mouseY;else{switch(i.xAlign){case"left":r=c.offset().left;break;case"right":r=c.offset().left+c.outerWidth();break;case"center":default:r=c.offset().left+c.outerWidth()/2}switch(i.yAlign){case"top":u=c.offset().top;break;case"bottom":u=c.offset().top+c.outerHeight();break;case"center":default:u=c.offset().top+c.outerHeight()/2}}r+=i.xOffset;u+=i.yOffset;switch(i.popupPosition){case"top":u-a-h-i.animationDistance+i.insetMargin<0?(u=u+a-i.insetMargin-i.yOffset+i.yOffset*-1+i.yOffsetInverted,i.popupPosition="bottom",n(t).attr("position","bottom")):(u=u-a-h+i.insetMargin,n(t).attr("position","top"));break;case"left":r-v-o-i.animationDistance+i.insetMargin<0?(r=r+v-i.insetMargin-i.xOffset+i.xOffset*-1+i.xOffsetInverted,i.popupPosition="right",n(t).attr("position","right")):(r=r-v-o+i.insetMargin,n(t).attr("position","left"));break;case"bottom":u+a+h+i.animationDistance-i.insetMargin>n(document).height()?(u=u-a-h+i.insetMargin-i.yOffset+i.yOffset*-1+i.yOffsetInverted,i.popupPosition="top",n(t).attr("position","top")):(u=u+a-i.insetMargin,n(t).attr("position","bottom"));break;case"right":default:r+v+o+i.animationDistance-i.insetMargin>n(window).width()?(r=r-v-o+i.insetMargin-i.xOffset+i.xOffset*-1+i.xOffsetInverted,r<0&&(r=0),i.popupPosition="left",n(t).attr("position","left")):(r=r+v-i.insetMargin,n(t).attr("position","right"))}if(e=!1,y=0,i.arrowEnabled)for(l.css({top:"",right:"",bottom:"",left:""});!e&&y<3;){y++;switch(i.popupAlign){case"top":f=u-a/2;f+h<=n(document).height()?(e=!0,u=f,n(t).attr("popupalign","top"),l.css("top","")):i.popupAlign="center";break;case"under-title":f=u-a/2-63;f+h<=n(document).height()?(e=!0,u=f,l.css("margin-top","25px")):i.popupAlign="center";break;case"right":s=r-(o-v/2);s>0?(e=!0,r=s,n(t).attr("popupalign","right"),l.css("right","")):i.popupAlign="left";break;case"bottom":f=u-(h-a/2);f>0?(e=!0,u=f,n(t).attr("popupalign","bottom"),l.css("bottom","")):i.popupAlign="top";break;case"left":s=r-v/2;s+o<=n(window).width()?(e=!0,r=s,n(t).attr("popupalign","left"),l.css("left","")):i.popupAlign="center";break;case"center":default:i.popupPosition=="left"||i.popupPosition=="right"?(f=u-h/2,f+h<=n(document).height()&&f>0?(e=!0,u=f,l.css("top",h/2-a/2+"px"),n(t).attr("popupalign","center")):i.popupAlign="bottom"):(i.popupPosition=="top"||i.popupPosition=="bottom")&&(s=r-o/2,s+o<=n(window).width()&&s>0?(e=!0,r-=o/2,l.css("left",o/2-v/2+"px"),n(t).attr("popupalign","center")):i.popupAlign="right")}}else while(!e&&y<3){y++;switch(i.popupAlign){case"top":u+h<=n(document).height()?(e=!0,n(t).attr("popupalign","top")):i.popupAlign="center";break;case"right":s=r-o;s>0?(e=!0,r=s,n(t).attr("popupalign","right")):i.popupAlign="left";break;case"bottom":f=u-h;f>0?(e=!0,u=f,n(t).attr("popupalign","bottom")):i.popupAlign="top";break;case"left":r+o<=n(window).width()?(e=!0,n(t).attr("popupalign","left")):i.popupAlign="center";break;case"center":default:i.popupPosition=="left"||i.popupPosition=="right"?(f=u-h/2,f+h<=n(document).height()&&f>0?(e=!0,u=f,n(t).attr("popupalign","center")):i.popupAlign="bottom"):(i.popupPosition=="top"||i.popupPosition=="bottom")&&(s=r-o/2,s+o<=n(window).width()&&s>0?(e=!0,r-=o/2,n(t).attr("popupalign","center")):i.popupAlign="right")}}return{x:r,y:u}},_removeOldPopups:function(){var t=this;n(".popup-balloon").each(function(){var i=n(this).data("controller");i.length&&i.removeData("popbox");n(this).remove();t.visible=!1})}})})(jQuery);
/*
//# sourceMappingURL=jquery.popupballoon.min.js.map
*/